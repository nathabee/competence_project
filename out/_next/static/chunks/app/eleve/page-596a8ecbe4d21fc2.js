(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76],{14438:(e,t,r)=>{Promise.resolve().then(r.bind(r,94671))},94671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var l=r(57437),s=r(2265),a=r(77640),n=r(16463),o=r(72609);r(63275);var c=r(53481);let i=e=>{let{eleves:t}=e,{activeEleve:r,setActiveEleve:a}=(0,o.a)(),[n,i]=(0,s.useState)(null),d=(0,c.Z)();if(0===t.length)return(0,l.jsx)("p",{children:d("msg_noStud")});let u=Array.from(new Set(t.map(e=>d(e.niveau_description)))),h=t.filter(e=>!n||d(e.niveau_description)===n),p=e=>{a(e)};return(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("h2",{children:d("pgH_studSel")}),(0,l.jsx)("div",{className:"filters",children:(0,l.jsxs)("label",{children:[d("tbH_level"),":",(0,l.jsxs)("select",{value:n||"",onChange:e=>i(e.target.value||null),style:{width:"200px",padding:"5px",fontSize:"16px"},className:"form-select",children:[(0,l.jsx)("option",{value:"",children:d("opt_all")}),u.map((e,t)=>(0,l.jsx)("option",{value:e,children:e},e||t))]})]})}),(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:d("tbH_name")}),(0,l.jsx)("th",{children:d("tbH_first")}),(0,l.jsx)("th",{children:d("tbH_level")}),(0,l.jsx)("th",{children:d("tbH_birthDt")}),(0,l.jsx)("th",{children:d("tbH_prof")})]})}),(0,l.jsx)("tbody",{children:h.map(e=>{var t;return(0,l.jsxs)("tr",{onClick:()=>p(e),className:(null==r?void 0:r.id)===e.id?"selected-row":"",style:{cursor:"pointer"},children:[(0,l.jsx)("td",{children:e.nom}),(0,l.jsx)("td",{children:e.prenom}),(0,l.jsx)("td",{children:d(e.niveau_description)}),(0,l.jsx)("td",{children:e.datenaissance}),(0,l.jsx)("td",{children:(null===(t=e.professeurs_details)||void 0===t?void 0:t.map(e=>e.username).join(", "))||d("msg_na")})]},e.id)})})]})]})};var d=r(9076),u=r(85042);let h=e=>{let{setEleves:t,closeForm:r}=e,{user:i,niveaux:d}=(0,o.a)(),h=(0,n.useRouter)(),[p,m]=(0,s.useState)(""),[x,j]=(0,s.useState)(""),[g,v]=(0,s.useState)(""),[f,_]=(0,s.useState)([]),[b,y]=(0,s.useState)([]),N=(0,c.Z)(),S=new Date,C=new Date(S.setFullYear(S.getFullYear()-5)).toISOString().split("T")[0],[w,D]=(0,s.useState)(C);(0,s.useEffect)(()=>{let e=async()=>{let e=(0,u.$)();if(!e||(0,u.p)(e)){h.push("/login");return}try{let t=await a.Z.get("".concat("/api","/users/?role=teacher"),{headers:{Authorization:"Bearer ".concat(e)}});y(t.data)}catch(e){console.error(N("msg.loadErr"),e)}};(null==i?void 0:i.roles.includes("admin"))&&e()},[i,h]);let E=async e=>{e.preventDefault();let l=(0,u.$)();if(!l||(0,u.p)(l)){h.push("/login");return}try{let e={nom:p,prenom:x,niveau:g,datenaissance:w,...(null==i?void 0:i.roles.includes("admin"))&&{professeurs:f}},s=(await a.Z.post("".concat("/api","/eleves/"),e,{headers:{Authorization:"Bearer ".concat(l)}})).data;t(e=>[...e,s]),r()}catch(e){console.error(N("msg_errCreateStud"),e)}};return(0,l.jsxs)("form",{onSubmit:E,children:[(0,l.jsx)("h1",{children:N("inf_welcome")}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:N("frm_name")}),(0,l.jsx)("input",{type:"text",className:"form-control",value:p,onChange:e=>m(e.target.value),required:!0,placeholder:N("msg_req")})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:N("form_first")}),(0,l.jsx)("input",{type:"text",className:"form-control",value:x,onChange:e=>j(e.target.value),required:!0,placeholder:N("msg_req")})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:N("form.level")}),(0,l.jsxs)("select",{className:"form-control",value:g,onChange:e=>v(e.target.value),required:!0,children:[(0,l.jsx)("option",{value:"",disabled:!0,children:N("frm_chooseLvl")}),null==d?void 0:d.map(e=>(0,l.jsx)("option",{value:e.id,children:N(e.description)},e.id))]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:N("frm_birthDt")}),(0,l.jsx)("input",{type:"date",className:"form-control",value:w,onChange:e=>D(e.target.value),required:!0,placeholder:N("msg_req")})]}),(null==i?void 0:i.roles.includes("admin"))&&(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{children:N("frm_prof")}),(0,l.jsx)("select",{multiple:!0,className:"form-control",onChange:e=>_(Array.from(e.target.selectedOptions,e=>e.value)),children:b.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.last_name," ",e.first_name]},e.id))})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary mt-3",children:N("frm_createStud")})]})};var p=r(12514);let m=()=>{let e=(0,n.useRouter)(),{user:t,activeEleve:r}=(0,o.a)(),m=(0,c.Z)(),[x,j]=(0,s.useState)([]),[g,v]=(0,s.useState)(""),[f,_]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!0),[N,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{let t=(0,u.$)();if(!t){e.push("/login");return}try{let e=await a.Z.get("".concat("/api","/eleves/"),{headers:{Authorization:"Bearer ".concat(t)}});j(e.data)}catch(e){console.error(m("msg_loadErr"),e),S(!0)}finally{y(!1)}})()},[e]);let C=x.filter(e=>"".concat(e.nom," ").concat(e.prenom).toLowerCase().includes(g.toLowerCase())).map(e=>{var r;return{...e,selectable:null===(r=e.professeurs_details)||void 0===r?void 0:r.some(e=>e.id===(null==t?void 0:t.id))}});return b?(0,l.jsxs)("div",{className:"loading-indicator",children:[(0,l.jsx)("p",{children:m("msg_loadStuds")}),(0,l.jsx)(p.Z,{animation:"border"})]}):N?(0,l.jsx)("p",{children:m("msg_loadErr")}):(0,l.jsxs)("div",{className:"container mt-3 ml-2 eleve-page",children:[(0,l.jsx)("h1",{children:m("pgH_studMgmt")}),b&&(0,l.jsx)(p.Z,{animation:"border"}),N&&(0,l.jsx)("div",{className:"alert alert-danger",role:"alert",children:m("msg_loadErr")}),!b&&!N&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:"tab-content mt-3",children:(0,l.jsxs)("div",{className:"tab-content mt-3",children:[(0,l.jsx)("div",{className:"search-bar mb-4",children:(0,l.jsx)("input",{type:"text",placeholder:m("frm_srchPlcHldr"),value:g,onChange:e=>v(e.target.value),className:"form-control"})}),r?(0,l.jsxs)(l.Fragment,{children:[m("rpt_selStudRpt",{name:"".concat(r.nom," ").concat(r.prenom)}),(0,l.jsx)(d.Z,{eleve:r})]}):(0,l.jsx)("p",{children:m("msg_selStud")}),(0,l.jsx)(i,{eleves:C}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("button",{className:"btn btn-primary",onClick:()=>_(!0),children:m("frm_addStud")})}),f&&(0,l.jsx)("div",{className:"eleve-form mt-4",children:(0,l.jsx)(h,{setEleves:j,closeForm:()=>_(!1)})})]})})})]})}},9076:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var l=r(57437),s=r(2265),a=r(77640),n=r(72609),o=r(98191);let c=e=>{let{report:t}=e,[r,a]=(0,s.useState)(!1);return(0,l.jsxs)("div",{className:"report-card",children:[(0,l.jsxs)("div",{className:"card-header",onClick:()=>{a(!r)},style:{cursor:"pointer"},children:[" ",(0,l.jsxs)("h4",{children:["Report ID: ",t.id]}),(0,l.jsxs)("p",{children:["Professeur ID: ",t.professeur]}),(0,l.jsxs)("p",{children:["Cr\xe9\xe9 le: ",(0,o.p6)(t.created_at)]}),(0,l.jsxs)("p",{children:["Mise en page du PDF: ",t.pdflayout]}),r?"▲":"▼"," "]}),r&&(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("h5",{children:"Type de tests:"}),(0,l.jsx)("ul",{children:t.report_catalogues.map(e=>(0,l.jsxs)("li",{children:[e.catalogue.description,(0,l.jsx)("ul",{children:e.resultats.map(e=>(0,l.jsxs)("li",{children:["Categorie de tests: ",e.groupage.desc_groupage,"  maxScore: ",Math.round(e.groupage.max_point),"   (",Math.round(e.seuil1_percent),"%/",Math.round(e.seuil2_percent),"%/",Math.round(e.seuil3_percent),"%)",(0,l.jsx)("ul",{children:e.resultat_details.map(e=>(0,l.jsxs)("li",{children:["Item: ",e.item.description,", Score: ",Math.round(e.score),"/ maxScore: ",Math.round(e.item.max_score)," , Label: ",e.scorelabel,", Description: ",e.observation]},e.id))})]},e.id))})]},e.id))})]})]})},i=e=>{let{eleve:t}=e,[r,o]=(0,s.useState)([]),[i,d]=(0,s.useState)(!0),[u,h]=(0,s.useState)(!1),{catalogue:p,setActiveReport:m,setActiveCatalogues:x,layouts:j,setActiveLayout:g}=(0,n.a)();(0,s.useEffect)(()=>{(async()=>{try{let e=document.cookie.split("authToken=")[1],r=await a.Z.get("".concat("/api","/eleve/").concat(t.id,"/reports/"),{headers:{Authorization:"Bearer ".concat(e)}});o(r.data)}catch(e){console.error("Error fetching reports:",e)}finally{d(!1)}})()},[t]);let v=e=>{h(!1);let t=e.report_catalogues.map(e=>e.catalogue.id);console.log("catalogueIds in the report",t),console.log("catalogue from context",p),console.log("Type of catalogueIds:",t.map(e=>typeof e)),console.log("Type of catalogue IDs in context:",p.map(e=>typeof e.id));let r=p.filter(e=>t.includes(e.id));x(r),r.length!==e.report_catalogues.length&&console.error("Mismatch in catalogues: Expected ".concat(e.report_catalogues.length," but found ").concat(r.length,". Looking for IDs: ").concat(t.join(", "),"."));let l=j.find(t=>t.id===e.pdflayout);console.log(" layout.id in the report",e.pdflayout),l?g(l):console.error("No matching layout found for ID: ".concat(e.pdflayout,". Report ID: ").concat(e.id)),0===j.filter(t=>t.id===e.pdflayout).length&&console.error("Expected layout for ID ".concat(e.pdflayout," not found in context. Report ID: ").concat(e.id)),console.log("setActiveReport will be called",e),m(e)};return i?(0,l.jsx)("p",{children:"Chargement des rapports..."}):(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{onClick:()=>h(!u),children:u?"Cacher":"Montrer"}),u&&(0,l.jsx)("div",{children:r.length>0?r.map(e=>(0,l.jsxs)("div",{className:"shadow-container",children:[(0,l.jsx)("button",{className:"button-warning",onClick:()=>v(e),children:"S\xe9lectionner ce rapport"}),(0,l.jsx)(c,{report:e})]},e.id)):(0,l.jsx)("p",{children:"Pas de rapport de tests trouv\xe9 pour cet \xe9l\xe8ve."})})]})}},53481:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var l=r(72609);let s=(e,t)=>e.replace(/\{(\w+)\}/g,(e,r)=>t[r]||"{".concat(r,"}")),a=()=>{let{translations:e}=(0,l.a)();return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=e[t];return l?s(l,r):"".concat(t)}}},63275:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[441,757,451,609,130,215,744],()=>t(14438)),_N_E=e.O()}]);