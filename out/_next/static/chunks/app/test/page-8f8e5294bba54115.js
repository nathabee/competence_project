(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{4137:(e,r,t)=>{Promise.resolve().then(t.bind(t,83315))},83315:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>u});var s=t(57437),l=t(2265),o=t(77640),a=t(16463),n=t(85042),i=t(72609),c=t(12514);t(68484);var d=t(9076);let u=()=>{let e=(0,a.useRouter)(),{scoreRulePoints:r,activeReport:t,activeEleve:u,user:p,setActiveReport:h,activeCatalogues:g,activeLayout:m}=(0,i.a)(),[x,v]=(0,l.useState)([]),[j,f]=(0,l.useState)(Array(x.length).fill(!1)),[b,y]=(0,l.useState)(!0),[_,C]=(0,l.useState)(!1),[S,k]=(0,l.useState)(null),E=(0,l.useMemo)(()=>({id:1,scorerule:1,scorelabel:"?",score:-1,description:"Default score rule"}),[]);if((0,l.useEffect)(()=>{let r=(0,n.$)();!r||(0,n.p)(r)?e.push("/login"):(k(r),y(!1)),t&&v(t.report_catalogues||[])},[e,t]),b)return(0,s.jsxs)("div",{className:"loading-indicator",children:[(0,s.jsx)("p",{children:"Chargement des donn\xe9es..."}),(0,s.jsx)(c.Z,{animation:"border"})]});if(!S)return null;let D=(e,r,t,s)=>{v(l=>{let o=[...l];return o[e].resultats[r].resultat_details[t].observation=s,f(e=>{let t=[...e];return t[r]=!0,t}),o})},N=(e,t,s,l,o)=>{let a=(null==r?void 0:r.find(e=>e.scorerule===o&&e.scorelabel===l))||E;v(r=>{let o=[...r],n=o[e].resultats[t].resultat_details[s];n.scorelabel=l;let i=n.item.max_score;return f(e=>{let r=[...e];return r[t]=!0,r}),n.score=8===n.item.scorerule?parseInt(l,10):a.score,n.score>i&&(n.score=Math.min(n.score,i)),o})},w=async(e,r)=>{let s={id:x[e].id,resultats:[]},l=x[e].resultats[r],a={id:l.id,resultat_details:[]};l.resultat_details.forEach(e=>{a.resultat_details.push({id:e.id,item_id:e.item.id,score:e.score,scorelabel:e.scorelabel,observation:e.observation})}),s.resultats.push(a),y(!0),C(!1);try{let e=await o.Z.patch("".concat("/api","/fullreports/").concat(null==t?void 0:t.id,"/"),{id:(null==t?void 0:t.id)||0,eleve:(null==u?void 0:u.id)||0,professeur:(null==p?void 0:p.id)||0,pdflayout:1,report_catalogues_data:[s]},{headers:{Authorization:"Bearer ".concat(S)}});f(e=>{let t=[...e];return t[r]=!1,t}),h(e.data)}catch(e){C(!0),console.error("Error updating report:",e)}finally{y(!1)}},I=async()=>{var e;if(!t){console.error("activeReport is null. Aborting submission.");return}let r=null===(e=document.cookie.split("authToken=")[1])||void 0===e?void 0:e.split(";")[0],s=[];x.forEach(e=>{let r={id:e.id,resultats:[]};e.resultats.forEach(e=>{let t={id:e.id,resultat_details:[]};e.resultat_details.forEach(e=>{t.resultat_details.push({id:e.id,item_id:e.item.id,score:e.score,scorelabel:e.scorelabel,observation:e.observation})}),t.resultat_details.length>0&&r.resultats.push(t)}),r.resultats.length>0&&s.push(r)}),y(!0),C(!1);try{if(s.length>0){let e=await o.Z.patch("".concat("/api","/fullreports/").concat(null==t?void 0:t.id,"/"),{id:(null==t?void 0:t.id)||0,eleve:(null==u?void 0:u.id)||0,professeur:(null==p?void 0:p.id)||0,pdflayout:1,report_catalogues_data:s},{headers:{Authorization:"Bearer ".concat(r)}});console.log("Patch request successful fullreports id",e.data),h(e.data),f(Array(x.length).fill(!1))}else console.log("No actual changes detected")}catch(e){return C(!0),console.error("Error updating report:",e),"Erreur mise \xe0 jour du rapport. Veuillez r\xe9essayer."}finally{y(!1)}},M=async()=>{var r;let t=null===(r=document.cookie.split("authToken=")[1])||void 0===r?void 0:r.split(";")[0];if(!g||0===g.length){console.error("Catalogue de test vide ou non s\xe9lectionn\xe9.");return}y(!0),C(!1);try{let r=g.map(e=>e.id),s=(await o.Z.post("".concat("/api","/fullreports/"),{eleve:null==u?void 0:u.id,professeur:null==p?void 0:p.id,pdflayout:1,catalogue_ids:r},{headers:{Authorization:"Bearer ".concat(t)}})).data;h(s),e.push("/test/")}catch(e){return C(!0),console.error("Error creating report:",e),"Erreur creation du rapport. Veuillez r\xe9essayer."}finally{y(!1)}};return b?(0,s.jsxs)("div",{className:"loading-indicator",children:[(0,s.jsx)("p",{children:"Chargement des donn\xe9es..."}),(0,s.jsx)(c.Z,{animation:"border"})]}):_?(0,s.jsx)("p",{children:"Erreur r\xe9cup\xe9ration des donn\xe9es. Recommencez plus tard SVP."}):(0,s.jsxs)("div",{className:"container mt-3 ml-2",children:[u&&m&&g?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{onClick:M,className:"button-warning",children:"Cr\xe9ation nouveau Report"})}):(0,s.jsx)("p",{children:"Commencez par s\xe9lectionner un \xe9l\xe8ve."}),t&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("button",{onClick:I,className:"button-warning",children:"Sauvegarde du rapport"})}),(0,s.jsx)("h1",{children:"History report \xe9l\xe8ve :"}),u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{children:"Report obtenus par l'\xe9l\xe8ve s\xe9lectionn\xe9 :"}),(0,s.jsx)(d.Z,{eleve:u})]}):(0,s.jsx)("p",{children:"Commencez par s\xe9lectionner un \xe9l\xe8ve pour voir le resultat"}),u?(0,s.jsxs)("div",{children:[t&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{children:["Report ID: ",t.id]}),(0,s.jsxs)("p",{children:["Professeur ID: ",t.professeur]}),(0,s.jsxs)("p",{children:["Cr\xe9\xe9 le: ",new Date(t.created_at).toLocaleDateString("fr-FR")]}),(0,s.jsxs)("p",{children:["Mise en page du PDF: ",t.pdflayout]})]}),(0,s.jsx)("h2",{children:"Cat\xe9gorie de tests:"}),0===x.length?(0,s.jsx)("p",{children:"Pas de cat\xe9gories de tests trouv\xe9e pour ce type de test."}):x.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{children:["Type de tests: ",e.catalogue.description]}),e.resultats.map((e,l)=>(0,s.jsxs)("div",{style:{backgroundColor:e.score<0?"var(--custom-warning)":"transparent"},children:[(0,s.jsxs)("h4",{children:["R\xe9sultat par cat\xe9gorie: ",e.groupage.desc_groupage]}),(0,s.jsxs)("p",{children:["Score total: ",e.score]}),e.resultat_details.map((e,o)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{children:["Test: ",e.item.description]}),(0,s.jsxs)("p",{children:["Score maximal: ",e.item.max_score]}),(0,s.jsx)("input",{type:"number",value:e.score,onChange:()=>N(t,l,o,e.scorelabel,e.item.scorerule)}),(0,s.jsx)("select",{value:e.scorelabel||E.scorelabel,onChange:r=>N(t,l,o,r.target.value,e.item.scorerule),children:8===e.item.scorerule?Array.from({length:e.item.max_score+1},(e,r)=>(0,s.jsx)("option",{value:r,children:r},r)):null==r?void 0:r.filter(r=>r.scorerule===e.item.scorerule||r.scorerule===E.scorerule).map(e=>(0,s.jsx)("option",{value:e.scorelabel,children:e.scorelabel},e.id))}),(0,s.jsx)("input",{type:"text",value:e.observation,onChange:e=>D(t,l,o,e.target.value)})]},o)),(0,s.jsx)("button",{onClick:()=>w(t,l),className:j[l]?"button-warning":"button-transparent",children:"Sauvegarde des r\xe9sultats"})]},l))]},t))]}):(0,s.jsx)("p",{children:"Selectionner un \xe9l\xe8ve SVP"})]})}},9076:(e,r,t)=>{"use strict";t.d(r,{Z:()=>c});var s=t(57437),l=t(2265),o=t(77640),a=t(72609),n=t(98191);let i=e=>{let{report:r}=e,[t,o]=(0,l.useState)(!1);return(0,s.jsxs)("div",{className:"report-card",children:[(0,s.jsxs)("div",{className:"card-header",onClick:()=>{o(!t)},style:{cursor:"pointer"},children:[" ",(0,s.jsxs)("h4",{children:["Report ID: ",r.id]}),(0,s.jsxs)("p",{children:["Professeur ID: ",r.professeur]}),(0,s.jsxs)("p",{children:["Cr\xe9\xe9 le: ",(0,n.p6)(r.created_at)]}),(0,s.jsxs)("p",{children:["Mise en page du PDF: ",r.pdflayout]}),t?"▲":"▼"," "]}),t&&(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("h5",{children:"Type de tests:"}),(0,s.jsx)("ul",{children:r.report_catalogues.map(e=>(0,s.jsxs)("li",{children:[e.catalogue.description,(0,s.jsx)("ul",{children:e.resultats.map(e=>(0,s.jsxs)("li",{children:["Categorie de tests: ",e.groupage.desc_groupage,"  maxScore: ",Math.round(e.groupage.max_point),"   (",Math.round(e.seuil1_percent),"%/",Math.round(e.seuil2_percent),"%/",Math.round(e.seuil3_percent),"%)",(0,s.jsx)("ul",{children:e.resultat_details.map(e=>(0,s.jsxs)("li",{children:["Item: ",e.item.description,", Score: ",Math.round(e.score),"/ maxScore: ",Math.round(e.item.max_score)," , Label: ",e.scorelabel,", Description: ",e.observation]},e.id))})]},e.id))})]},e.id))})]})]})},c=e=>{let{eleve:r}=e,[t,n]=(0,l.useState)([]),[c,d]=(0,l.useState)(!0),[u,p]=(0,l.useState)(!1),{catalogue:h,setActiveReport:g,setActiveCatalogues:m,layouts:x,setActiveLayout:v}=(0,a.a)();(0,l.useEffect)(()=>{(async()=>{try{let e=document.cookie.split("authToken=")[1],t=await o.Z.get("".concat("/api","/eleve/").concat(r.id,"/reports/"),{headers:{Authorization:"Bearer ".concat(e)}});n(t.data)}catch(e){console.error("Error fetching reports:",e)}finally{d(!1)}})()},[r]);let j=e=>{p(!1);let r=e.report_catalogues.map(e=>e.catalogue.id);console.log("catalogueIds in the report",r),console.log("catalogue from context",h),console.log("Type of catalogueIds:",r.map(e=>typeof e)),console.log("Type of catalogue IDs in context:",h.map(e=>typeof e.id));let t=h.filter(e=>r.includes(e.id));m(t),t.length!==e.report_catalogues.length&&console.error("Mismatch in catalogues: Expected ".concat(e.report_catalogues.length," but found ").concat(t.length,". Looking for IDs: ").concat(r.join(", "),"."));let s=x.find(r=>r.id===e.pdflayout);console.log(" layout.id in the report",e.pdflayout),s?v(s):console.error("No matching layout found for ID: ".concat(e.pdflayout,". Report ID: ").concat(e.id)),0===x.filter(r=>r.id===e.pdflayout).length&&console.error("Expected layout for ID ".concat(e.pdflayout," not found in context. Report ID: ").concat(e.id)),console.log("setActiveReport will be called",e),g(e)};return c?(0,s.jsx)("p",{children:"Chargement des rapports..."}):(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:()=>p(!u),children:u?"Cacher":"Montrer"}),u&&(0,s.jsx)("div",{children:t.length>0?t.map(e=>(0,s.jsxs)("div",{className:"shadow-container",children:[(0,s.jsx)("button",{className:"button-warning",onClick:()=>j(e),children:"S\xe9lectionner ce rapport"}),(0,s.jsx)(i,{report:e})]},e.id)):(0,s.jsx)("p",{children:"Pas de rapport de tests trouv\xe9 pour cet \xe9l\xe8ve."})})]})}},68484:()=>{}},e=>{var r=r=>e(e.s=r);e.O(0,[441,451,609,130,215,744],()=>r(4137)),_N_E=e.O()}]);