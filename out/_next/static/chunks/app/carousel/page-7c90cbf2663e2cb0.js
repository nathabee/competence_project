(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{5537:(e,t,l)=>{Promise.resolve().then(l.bind(l,66735))},66735:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>c});var s=l(57437),r=l(2265),a=l(16463),i=l(85042),o=l(12514);l(68484);var u=l(77640),n=l(72609);let d=()=>{var e,t,l,a;let[o,d]=(0,r.useState)(0),{activeReport:c,scoreRulePoints:h,activeEleve:v,user:p,setActiveReport:m}=(0,n.a)(),[g,x]=(0,r.useState)([]),[f,_]=(0,r.useState)([]),[b,j]=(0,r.useState)(!1),[E,y]=(0,r.useState)(!1),S=(0,r.useMemo)(()=>({id:1,scorerule:1,scorelabel:"?",score:-1,description:"Default score rule"}),[]);(0,r.useEffect)(()=>{c&&(x(c.report_catalogues||[]),_(c.report_catalogues.flatMap(e=>Array(e.resultats.length).fill(!1))))},[c]);let C=(0,r.useMemo)(()=>{let e=[];return g.forEach((t,l)=>{t.resultats.forEach((t,s)=>{t.resultat_details.forEach((t,r)=>{e.push({catalogueIndex:l,resultatIndex:s,detailIndex:r})})})}),e},[g]),{catalogueIndex:k=0,resultatIndex:N=0,detailIndex:M=0}=C[o]||{},w=null===(t=g[k])||void 0===t?void 0:null===(e=t.resultats[N])||void 0===e?void 0:e.resultat_details[M],A=(e,t)=>{let l=g.slice(0,e).reduce((e,t)=>e+t.resultats.length,0)+t;_(e=>{let t=[...e];return t[l]=!0,t})},R=e=>{x(t=>{let l=[...t];return l[k].resultats[N].resultat_details[M].observation=e,A(k,N),l})},z=(e,t)=>{let l=(null==h?void 0:h.find(l=>l.scorerule===t&&l.scorelabel===e))||S;x(t=>{let s=[...t],r=s[k].resultats[N].resultat_details[M];return r.scorelabel=e,r.score=8===r.item.scorerule?parseInt(e,10):l.score,r.score>r.item.max_score&&(r.score=Math.min(r.score,r.item.max_score)),A(k,N),s})},O=async(e,t)=>{let l={id:g[e].id,resultats:[]},s=g[e].resultats[t],r={id:s.id,resultat_details:[]};s.resultat_details.forEach(e=>{r.resultat_details.push({id:e.id,item_id:e.item.id,score:e.score,scorelabel:e.scorelabel,observation:e.observation})}),l.resultats.push(r),j(!0),y(!1);try{let s=await u.Z.patch("".concat("/api","/fullreports/").concat(null==c?void 0:c.id,"/"),{id:(null==c?void 0:c.id)||0,eleve:(null==v?void 0:v.id)||0,professeur:(null==p?void 0:p.id)||0,pdflayout:1,report_catalogues_data:[l]},{headers:{Authorization:"Bearer ".concat((0,i.$)())}});_(l=>{let s=g.slice(0,e).reduce((e,t)=>e+t.resultats.length,0)+t,r=[...l];return r[s]=!1,r}),m(s.data)}catch(e){y(!0),console.error("Error updating report:",e)}finally{j(!1)}};return(0,r.useEffect)(()=>{var e,t,l;let s=(null===(l=g[k])||void 0===l?void 0:null===(t=l.resultats[N])||void 0===t?void 0:null===(e=t.resultat_details)||void 0===e?void 0:e.length)===M+1;f[g.slice(0,k).reduce((e,t)=>e+t.resultats.length,0)+N]&&s&&(console.log("handleSaveResultat modified and last detail"),O(k,N))},[g,f,k,N,M]),(0,s.jsxs)("div",{children:[w&&h&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{children:["Type de test: ",null===(l=g[k])||void 0===l?void 0:l.catalogue.description]}),(0,s.jsxs)("h4",{children:["R\xe9sultat: ",null===(a=g[k].resultats[N])||void 0===a?void 0:a.groupage.desc_groupage]}),(0,s.jsxs)("p",{children:["Test: ",w.item.description]}),(0,s.jsxs)("p",{children:["Score maximal: ",w.item.max_score]}),(0,s.jsx)("input",{type:"number",value:w.score,onChange:e=>z(e.target.value,w.item.scorerule)}),(0,s.jsx)("select",{value:w.scorelabel||S.scorelabel,onChange:e=>z(e.target.value,w.item.scorerule),children:8===w.item.scorerule?Array.from({length:w.item.max_score+1},(e,t)=>(0,s.jsx)("option",{value:t,children:t},t)):h.filter(e=>e.scorerule===w.item.scorerule).map(e=>(0,s.jsx)("option",{value:e.scorelabel,children:e.scorelabel},e.id))}),(0,s.jsx)("input",{type:"text",value:w.observation,onChange:e=>R(e.target.value)}),(0,s.jsxs)("div",{className:"carousel-navigation",children:[(0,s.jsx)("button",{onClick:()=>{o>0&&d(o-1)},disabled:0===o,children:"Pr\xe9c\xe9dent"}),(0,s.jsx)("button",{onClick:()=>{o<C.length-1&&d(o+1)},disabled:o===C.length-1,children:"Suivant"})]})]}),b&&(0,s.jsx)("p",{children:"Chargement en cours..."}),E&&(0,s.jsx)("p",{children:"Erreur lors de la sauvegarde. Veuillez r\xe9essayer."})]})},c=()=>{let e=(0,a.useRouter)(),[t,l]=(0,r.useState)(!0),[u,n]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let t=(0,i.$)();!t||(0,i.p)(t)?e.push("/login"):(n(t),l(!1))},[e]),t)?(0,s.jsxs)("div",{className:"loading-indicator",children:[(0,s.jsx)("p",{children:"Chargement des donn\xe9es..."}),(0,s.jsx)(o.Z,{animation:"border"})]}):u?(0,s.jsx)("div",{className:"container mt-3 ml-2",children:(0,s.jsx)(d,{})}):null}},68484:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[441,451,609,130,215,744],()=>t(5537)),_N_E=e.O()}]);